#+TITLE: Data_analysis

Estadistica descriptiva a los datos por medio de funciones de agregacion, es importate saber un poco de algebra relacional.

 + Funciones de agregación
   - min
   - max
   - media
   - moda
   - conteo
   - sumatoria
   - kutosis
   - variaza
   - desviacion estándar
 + Algebra relacional
   - transposicion
   - selección
   - proyección
   - uniones
   - joins
   - agrupación


* Imports
#+NAME: imports
#+BEGIN_SRC python :session data :results replace drawer output :exports both
import pandas as pd
from tabulate import tabulate
from typing import Tuple, List


def print_tabulate(df: pd.DataFrame):
    print(tabulate(df, headers=df.columns, tablefmt='orgtbl'))

#+END_SRC

#+RESULTS: imports
:results:
:end:


* UANL


#+BEGIN_SRC python :session data :results replace drawer output :exports both :tangle uanl_analysis.py :noweb yes :eval never-export
<<imports>>
import matplotlib.pyplot as plt

def analysis(file_name:str)->None:
    df_complete = pd.read_csv(file_name)
    df_complete["Fecha"] = pd.to_datetime(df_complete["anio"].map(str)+ "-" + df_complete["mes"].map(str), format="%Y-%m")
    df_complete = df_complete.drop(['anio', 'mes'], axis=1)
    df_by_dep = df_complete.groupby(["dependencia", "Fecha"])[["Sueldo Neto"]].aggregate(pd.DataFrame.sum)
    # df_by_dep_by_anio = df_by_dep.groupby(["dependencia","anio"]).aggregate(pd.DataFrame.sum).sort_values(by=["dependencia", "anio"], ascending=True)
    df_by_dep.reset_index(inplace=True)
    # df_by_dep.set_index("Fecha", inplace=True)
    print_tabulate(df_by_dep.head(50))

    # for dep in set(df_by_dep["dependencia"]):
    #     plot_by_dep(df_by_dep, dep)
    # df_by_dep.groupby("dependencia")["Sueldo Neto"].plot(y = ["Sueldo Neto"])
    # plt.savefig("img/foo.png")# , bbox_inches='tight')

    df_by_dep.boxplot(by ='dependencia')
    plt.savefig("img/boxplot.png")# , bbox_inches='tight')

def plot_by_dep(df: pd.DataFrame, dep:str)->None:
    df[df["dependencia"] == dep].plot(y =["Sueldo Neto"])
    plt.savefig(f"img/lt_{dep}.png")
    df[df["dependencia"] == dep].boxplot(by ='dependencia')
    plt.savefig(f"img/bplt_{dep}.png")

analysis("csv/uanl.csv")
#print_tabulate(df.head(50))

#+END_SRC

#+RESULTS:
:results:
|    | dependencia                                                 | Fecha               | Sueldo Neto |
|----+-------------------------------------------------------------+---------------------+-------------|
|  0 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2019-12-01 00:00:00 |      518869 |
|  1 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-01-01 00:00:00 |      528440 |
|  2 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-02-01 00:00:00 |      567098 |
|  3 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-03-01 00:00:00 |      570808 |
|  4 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-04-01 00:00:00 |      586530 |
|  5 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-05-01 00:00:00 |      541917 |
|  6 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-06-01 00:00:00 |      488611 |
|  7 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-07-01 00:00:00 |      537647 |
|  8 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-08-01 00:00:00 |      539956 |
|  9 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-09-01 00:00:00 |      530942 |
| 10 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-10-01 00:00:00 |      534471 |
| 11 | "CAPILLA ALFONSINA" BIBLIOTECA UNIVERSITARIA                | 2020-11-01 00:00:00 |      522213 |
| 12 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2019-12-01 00:00:00 |      522851 |
| 13 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-01-01 00:00:00 |      538866 |
| 14 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-02-01 00:00:00 |      566887 |
| 15 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-03-01 00:00:00 |      559181 |
| 16 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-04-01 00:00:00 |      561757 |
| 17 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-05-01 00:00:00 |      561688 |
| 18 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-06-01 00:00:00 |      509125 |
| 19 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-07-01 00:00:00 |      573090 |
| 20 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-08-01 00:00:00 |      597668 |
| 21 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-09-01 00:00:00 |      597146 |
| 22 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-10-01 00:00:00 |      597668 |
| 23 | AUDITORIA INTERNA DE LA U.A.N.L.                            | 2020-11-01 00:00:00 |      588164 |
| 24 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2019-12-01 00:00:00 |     78995.3 |
| 25 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-01-01 00:00:00 |     83088.7 |
| 26 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-02-01 00:00:00 |     83135.8 |
| 27 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-03-01 00:00:00 |     83561.8 |
| 28 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-04-01 00:00:00 |     85095.4 |
| 29 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-05-01 00:00:00 |     77881.7 |
| 30 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-06-01 00:00:00 |     75847.6 |
| 31 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-07-01 00:00:00 |       82585 |
| 32 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-08-01 00:00:00 |     90114.1 |
| 33 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-09-01 00:00:00 |     89665.7 |
| 34 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-10-01 00:00:00 |     90114.1 |
| 35 | C. INNOVACION; INVEST. Y DESLLO. DE INGENIERIA Y TECNOLOGIA | 2020-11-01 00:00:00 |     87664.6 |
| 36 | C.DE ESTUDIOS HUMANISTICOS                                  | 2019-12-01 00:00:00 |       54786 |
| 37 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-01-01 00:00:00 |       54788 |
| 38 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-02-01 00:00:00 |     54926.9 |
| 39 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-03-01 00:00:00 |     55655.4 |
| 40 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-04-01 00:00:00 |     56277.4 |
| 41 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-05-01 00:00:00 |     57396.2 |
| 42 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-06-01 00:00:00 |     52422.8 |
| 43 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-07-01 00:00:00 |     57396.2 |
| 44 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-08-01 00:00:00 |     87681.8 |
| 45 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-09-01 00:00:00 |     90779.9 |
| 46 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-10-01 00:00:00 |       89304 |
| 47 | C.DE ESTUDIOS HUMANISTICOS                                  | 2020-11-01 00:00:00 |     86996.9 |
| 48 | C.DE INV.Y DES.DE ED.BILINGUE                               | 2019-12-01 00:00:00 |      547029 |
| 49 | C.DE INV.Y DES.DE ED.BILINGUE                               | 2020-01-01 00:00:00 |      467850 |
:end:

[[file:img/foo.png]]

[[file:img/boxplot.png]]

* Estados

#+BEGIN_SRC python :session data :results replace drawer output :exports both :tangle estados_analysis.py :noweb yes :eval never-export
<<imports>>
def analysis(file_name:str)->pd.DataFrame:
    df = pd.read_csv(file_name)
    df["hab_x_km2"] = df["poblacion_2020"] / df["area_km"]
    df["hab_x_mi"] = df["poblacion_2020"] / df["area_mi"]
    print(sum(df["poblacion_2020"]))
    return df

df = analysis("csv/estados_limpio.csv")
print_tabulate(df.head())
print_tabulate(df.describe())
print(df["poblacion_2020"].sum())

#+END_SRC

#+RESULTS:
:results:
126 014 024.0


|    | estado              | nombre_oficial      | capital                   | ciudad_mas_grande         |   poblacion_2020 |   num_de_municipios |   lugar | fecha_de_admision   |   area_km |   area_mi |   hab_x_km2 |   hab_x_mi |
|----+---------------------+---------------------+---------------------------+---------------------------+------------------+---------------------+---------+---------------------+-----------+-----------+-------------+------------|
|  0 | Aguascalientes      | Aguascalientes      | Aguascalientes            | Aguascalientes            |      1.42561e+06 |                  11 |      24 | 1857-02-05          |    5615.7 |    2168.2 |    253.861  |   657.507  |
|  1 | Baja California     | Baja California     | Mexicali                  | Tijuana                   |      3.76902e+06 |                   6 |      29 | 1952-01-16          |   71450   |   27587   |     52.7505 |   136.623  |
|  2 | Baja California Sur | Baja California Sur | La Paz                    | La Paz                    | 798447           |                   5 |      31 | 1974-10-08          |   73909.4 |   28536.6 |     10.8031 |    27.9798 |
|  3 | Campeche            | Campeche            | San Francisco de Campeche | San Francisco de Campeche | 928363           |                  13 |      25 | 1863-04-29          |   57484.9 |   22195   |     16.1497 |    41.8276 |
|  4 | Chiapas             | Chiapas             | Tuxtla Gutiérrez          | Tuxtla Gutiérrez          |      5.54383e+06 |                 124 |      19 | 1824-09-14          |   73311   |   28305.5 |     75.6207 |   195.857  |



|       |   poblacion_2020 |   num_de_municipios |    lugar |   area_km |   area_mi |   hab_x_km2 |   hab_x_mi |
|-------+------------------+---------------------+----------+-----------+-----------+-------------+------------|
| count |     32           |             32      | 32       |      32   |     32    |     32      |    32      |
| mean  |      3.93794e+06 |             77.1875 | 16.5     |   61270.2 |  23656.6  |    309.679  |   802.022  |
| std   |      3.27801e+06 |            105.268  |  9.38083 |   53819   |  20779.6  |   1078.71   |  2793.61   |
| min   | 731391           |              5      |  1       |    1494.3 |    577    |     10.8031 |    27.9798 |
| 25%   |      1.85165e+06 |             17.75   |  8.75    |   24136.1 |   9319.05 |     43.36   |   112.302  |
| 50%   |      3.05489e+06 |             48.5    | 16.5     |   58041.8 |  22410    |     67.1707 |   173.971  |
| 75%   |      4.94759e+06 |             89.5    | 24.25    |   74250.9 |  28668.4  |    159.016  |   411.848  |
| max   |      1.69924e+07 |            570      | 32       |  247413   |  95526.5  |   6163.38   | 15961.8    |
126 014 024.0
:end:
